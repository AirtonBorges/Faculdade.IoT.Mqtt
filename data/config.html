<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configurar WiFi</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box}
    :root{--primary:#6200ee;--on-primary:#fff;--surface:#fff;--bg:#f2f2f6;--muted:#666;--text:#222;--muted-border:rgba(0,0,0,0.08)}
    body.dark{--primary:#8b5cf6;--on-primary:#ffffff;--surface:#161616;--bg:#0f0f10;--muted:#bdbdbd;--text:#eaeaea;--muted-border:rgba(255,255,255,0.12)}
    body{font-family:Roboto,Arial,sans-serif;background:var(--bg);margin:0;padding:20px;display:flex;align-items:flex-start;justify-content:center;min-height:100vh;color:var(--text)}
    .wrap{width:100%;max-width:520px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    .title{background:var(--primary);color:var(--on-primary);padding:12px 16px;border-radius:8px;text-align:center;font-weight:500;flex:1;margin-right:12px}
    .theme-btn{background:var(--surface);border:1px solid var(--muted-border);color:var(--text);font-size:16px;cursor:pointer;padding:12px 12px;border-radius:8px;font-weight:500;white-space:nowrap;box-shadow:0 2px 6px rgba(0,0,0,0.06);transition:border-color 160ms, box-shadow 160ms, transform 120ms}
    body.dark .theme-btn{color:var(--text)}
    .theme-btn:hover{border-color: rgba(98,0,238,0.18);box-shadow:0 6px 18px rgba(98,0,238,0.06)}
    .theme-btn:active{transform:translateY(1px)}
    .card{background:var(--surface);padding:16px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,0.06);color:var(--text)}
    label{display:block;margin-bottom:8px;color:var(--muted);font-size:14px}
    input[type=text], input[type=password]{width:100%;padding:10px;border-radius:8px;border:1px solid var(--muted-border);outline:none;font-size:15px;background:color-mix(in srgb, var(--surface) 88%, black 12%);color:var(--text);max-width:100%;display:block;transition:border-color 160ms, box-shadow 160ms}
    input[type=text]:focus, input[type=password]:focus{border-color: rgba(98,0,238,0.28);box-shadow:0 8px 24px rgba(98,0,238,0.06)}
    .actions{display:flex;gap:8px;margin-top:12px}
    .actions button{padding:10px 14px;border-radius:8px;border:1px solid var(--muted-border);background:transparent;cursor:pointer;color:var(--text);font-weight:500;transition:border-color 160ms, box-shadow 160ms, transform 120ms}
    .actions .btn{background:var(--primary);color:var(--on-primary);border-color:transparent}
    .actions .btn-muted{background:transparent;color:var(--text)}
    .actions button:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    .actions button:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .actions button:hover{border-color: rgba(98,0,238,0.14);box-shadow:0 6px 18px rgba(98,0,238,0.04)}
    .actions button:active{transform:translateY(1px)}
    body.dark .actions button{border-color:var(--muted-border);color:var(--text)}
    .net-list{list-style:none;padding:0;margin-top:12px;max-height:220px;overflow:auto}
    .net-item{padding:8px;border-radius:8px;border:1px solid var(--muted-border);margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;color:var(--text);background:transparent;gap:8px}
    .net-item span{color:var(--text);display:block;max-width:calc(100% - 110px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .net-item .btn-muted{padding:6px 10px;border-radius:6px;border:1px solid var(--muted-border);background:transparent;color:var(--text);font-weight:500;transition:border-color 160ms, box-shadow 160ms, transform 120ms}
    .net-item .btn-muted:hover{border-color: rgba(98,0,238,0.14);box-shadow:0 6px 16px rgba(98,0,238,0.03)}
    .net-item .btn-muted:active{transform:translateY(1px)}
    body.dark .net-item{border-color:var(--muted-border)}
    body.dark .net-item .btn-muted{border-color:var(--muted-border)}
    .scan-status{color:var(--muted);font-size:13px;margin-top:8px}
    .field-error{color:#ffb4ab;background:rgba(255,69,58,0.03);border-left:4px solid #ff453a;padding:8px;border-radius:6px;margin-top:8px;font-size:0.95rem}
    /* shared helpers (inlined) */
    :root, body, .card, .title { transition: background-color 200ms ease, color 200ms ease, box-shadow 200ms ease; }
    .action-btn{display:inline-flex;align-items:center;gap:0.5rem;padding:0.6rem 1rem;border-radius:2rem;border:none;cursor:pointer;font-weight:400;font-size:clamp(0.95rem,3.5vw,1.05rem);align-self:center;white-space:nowrap;justify-content:center}
    .action-btn.filled{background:var(--primary);color:var(--on-primary);box-shadow:0 6px 18px rgba(98,0,238,0.12)}
    .action-btn.ghost{background:transparent;color:var(--primary);border:1px solid var(--muted-border);min-width:0;padding:0.6rem 1rem}
    body.dark .action-btn.ghost{border-color:var(--muted-border);color:var(--primary)}
    .action-btn:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,0.08)}
    .action-btn:active{transform:translateY(-1px) scale(0.995);box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    body.dark .action-btn:hover{box-shadow:0 10px 24px rgba(255,255,255,0.02)}
    .muted{color:var(--muted);font-size:0.95rem}
    .small-note{margin-top:0.625rem;color:var(--muted);font-size:0.875rem;text-align:center}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Configurar Wiâ€‘Fi</div>
      <button id="theme-toggle" class="theme-btn" aria-label="Alternar tema">ðŸŒ™</button>
    </header>
    <div class="card">
      <form id="wifi-form" method="POST" action="/save">
        <label for="ssid">SSID</label>
        <input id="ssid" name="ssid" type="text" required>
        <label for="pass">Senha</label>
        <input id="pass" name="pass" type="password">
          <div id="ssid-error" class="field-error" style="display:none" role="alert" aria-live="polite"></div>
          <div class="actions">
            <button class="btn" type="submit">Salvar e conectar</button>
            <button id="rescan-btn" type="button" class="btn-muted">Recarregar redes</button>
            <button id="clear-btn" type="button" class="btn-muted">Apagar credenciais</button>
          </div>
      </form>
      <div class="scan-status" id="scan-status">Procurando redes...</div>
      <ul id="net-list" class="net-list"></ul>
    </div>
  </div>
  <script>
  (function(){
    const btn = document.getElementById('theme-toggle');
    const apply = (mode)=>{ if(mode==='dark') document.body.classList.add('dark'); else document.body.classList.remove('dark'); btn.textContent = (mode==='dark')? 'â˜€ï¸':'ðŸŒ™'; };
    const stored = localStorage.getItem('theme');
    if(stored){ apply(stored); }
    else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){ apply('dark'); }
    btn.addEventListener('click', ()=>{
      const isDark = document.body.classList.toggle('dark');
      const mode = isDark? 'dark':'light';
      localStorage.setItem('theme', mode);
      btn.textContent = isDark? 'â˜€ï¸':'ðŸŒ™';
    });
    window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e=>{
      if(!localStorage.getItem('theme')) apply(e.matches? 'dark':'light');
    });
  })();

  async function doScan(noCache){
    try{
      document.getElementById('scan-status').textContent = 'Scan em andamento...';
      const r = await fetch('/scan', {cache: noCache? 'no-store':'default'});
      const list = await r.json();
      const ul = document.getElementById('net-list'); ul.innerHTML = '';
      if(!list || list.length===0){ document.getElementById('scan-status').textContent = 'Nenhuma rede encontrada'; return; }
      document.getElementById('scan-status').textContent = '';
      list.forEach(n => {
        const li = document.createElement('li');
        li.className = 'net-item';
        const span = document.createElement('span');
        span.textContent = n.ssid + (n.secure? ' ðŸ”’':'');
        const btn = document.createElement('button');
        btn.className = 'btn-muted';
        btn.textContent = 'Selecionar';
        btn.onclick = ()=>{ document.getElementById('ssid').value = n.ssid; };
        li.appendChild(span);
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }catch(e){ document.getElementById('scan-status').textContent = 'Erro no scan'; }
  }
  window.onload = ()=> doScan(false);
  document.getElementById('rescan-btn').onclick = ()=> doScan(true);
  document.getElementById('clear-btn').onclick = async ()=>{
    if(!confirm('Apagar credenciais salvas no dispositivo?')) return;
    try{
      const r = await fetch('/clear', {method:'POST'});
      const txt = await r.text();
      alert(txt);
    }catch(e){ alert('Erro ao apagar'); }
  };
  </script>
</body>
</html>
